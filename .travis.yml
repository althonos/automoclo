sudo: false
dist: xenial
language: python
cache: pip

python:
- '2.7'
- '3.4'
- '3.5'
- '3.6'
- '3.7'
- pypy
- pypy3.5

matrix:
  allow_failures:
  - python: pypy
  - python: pypy3.5
  - python: '3.7'

before_install:
- ci/travis/decrypt-all.sh
- pip install -U -r ci/requirements.txt

install:
- pip install ./moclo ./moclo-ytk ./moclo-cidar ./moclo-ecoflex

before_script:
- pip install -U -r tests/requirements.txt

script:
- green

after_script:
- python -m codecov
- python -m codacy

before_deploy:
- ci/travis/before-deploy.sh

deploy:
  provider: script
  script: twine upload --skip-existing dist/*
  skip_cleanup: true
  on:
    tags: true
    python: '3.6'
    repo: althonos/moclo

notifications:
  email:
  - althonosdev@gmail.com
